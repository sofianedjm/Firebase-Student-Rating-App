<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="../styles/login.css" rel="stylesheet" type="text/css" />
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <title>Page de détail</title>
</head>
<body>
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import {
        getFirestore,
        getDoc,
        doc,
    } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDE7XOEw-un4Z5rJVBMQPuZJ2ADxzFgA50",
        authDomain: "fir-student-rating-app.firebaseapp.com",
        projectId: "fir-student-rating-app",
        storageBucket: "fir-student-rating-app.appspot.com",
        messagingSenderId: "893481620816",
        appId: "1:893481620816:web:662a0041d2343ed0f74855",
        measurementId: "G-25X6JZ06JT",
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const urlParams = new URLSearchParams(window.location.search);
    const itemId = urlParams.get('param');

    const docRef = doc(db, "book", itemId);
    const docSnap = await getDoc(docRef);
    var selectedItem = ""

    if (docSnap.exists()) {
        selectedItem = docSnap.data()
        console.log("Document data:", docSnap.data());
    } else {
        selectedItem = ""
        console.log("No such document!");
    }

    const resultatsDiv = document.getElementById("resultat");
    const title = document.createElement("h2");
    title.textContent = selectedItem.title
    const author = document.createElement("p");
    author.textContent = selectedItem.author;
    const description = document.createElement("p");
    description.textContent = selectedItem.description;
    resultatsDiv.appendChild(title);
    resultatsDiv.appendChild(author);
    resultatsDiv.appendChild(description);


    const noteUsers = document.getElementById("listeCommentaires");
    console.log(selectedItem.evaluations);
    var noteMoyenneProduit = 0
    Object.entries(selectedItem.evaluations).forEach( ([key,val]) => {
        noteMoyenneProduit+=val;
        var evals = document.createElement("li");
        evals.textContent = "Utilisateurs: " + key + " Note: " + val;
        noteUsers.appendChild(evals);
    })


    const noteProduit = document.getElementById("noteProduit");
    const noteP = document.createElement("span");
    noteP.textContent = selectedItem.evaluations
    noteProduit.appendChild(noteP);





</script>

<div>
    <nav class="navbar fixed-top navbar-light bg-light">
        <a class="navbar-brand" href="#">Home</a>

        <form class="form-inline my-2 my-lg-0">
            <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
            <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
        </form>
        <div>
            <a class="navbar-brand " href="#">register</a>
            <a class="navbar-brand " href="#">log in</a>
        </div>
    </nav>
    <nav class="navbar navbar-light bg-light" id="monBloc">
        <a class="navbar-brand" href="#">Home</a>

        <form class="form-inline my-2 my-lg-0">
            <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
            <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
        </form>
        <div>
            <a class="navbar-brand " href="#">register</a>
            <a class="navbar-brand " href="#">log in</a>
        </div>
    </nav>
</div>

<div class="container mt-5">
    <div class="row">
        <div class="col-md-6">
            <img src="https://static.vecteezy.com/system/resources/previews/009/384/332/non_2x/old-vintage-book-clipart-design-illustration-free-png.png" class="img-fluid" alt="Image du produit">
        </div>

        <div class="col-md-6">
            <div id="resultat">
            </div>
            <strong>Note du Produit : </strong>
            <div id="noteProduit"></div>

            <div class="form-group">
                <label for="evaluation">Évaluation :</label>
                <select class="form-control" id="evaluation">
                    <option value="5">5 étoiles</option>
                    <option value="4">4 étoiles</option>
                    <option value="3">3 étoiles</option>
                    <option value="2">2 étoiles</option>
                    <option value="1">1 étoile</option>
                </select>
            </div>

            <button type="submit" class="btn btn-primary">Soumettre</button>
        </div>
    </div>
    <div class="row mt-4">
        <div class="col-md-12">
            <div>
                <strong>Notes des Utilisateurs :</strong>
                <ul id="listeCommentaires">
                </ul>
            </div>
        </div>
    </div>
</div>

</body>
</html>
